import{_ as s,c as a,o as t,af as n}from"./chunks/framework.BKqm66bb.js";const d=JSON.parse('{"title":"配置 micro SAPI","description":"","frontmatter":{},"headers":[],"relativePath":"zh/customization.md","filePath":"zh/customization.md"}'),h={name:"zh/customization.md"};function l(p,i,e,k,r,o){return t(),a("div",null,[...i[0]||(i[0]=[n(`<h1 id="配置-micro-sapi" tabindex="-1">配置 micro SAPI <a class="header-anchor" href="#配置-micro-sapi" aria-label="Permalink to “配置 micro SAPI”">​</a></h1><p>micro SAPI 在某些场景下可能需要进行自定义配置，以满足特定的需求。</p><p>当前 micro SAPI 的配置主要分为以下几种：</p><ul><li><strong>伪装 SAPI 名称</strong>：某些扩展或库可能会根据 SAPI 名称进行不同的行为判断。通过配置伪装 SAPI 名称，可以让这些扩展或库认为当前运行环境是 cli，从而避免兼容性问题。</li><li><strong>INI 注入</strong>：可以将自定义的 ini 配置注入到 micro.sfx 二进制中，以覆盖默认的 PHP 配置。这对于需要特定配置的应用程序非常有用。</li><li><strong>自定义 Win32 元信息</strong>：在 Windows 平台上，可以自定义 micro.sfx 的元信息，如文件描述、exe 图标等。</li></ul><p>本章节用于介绍如何使用它们。有关这些配置以及 micro SAPI 的更多技术细节，请见章节 <a href="./digging-deeper.html">深入 micro 内部</a>。</p><h2 id="伪装-sapi-名称" tabindex="-1">伪装 SAPI 名称 <a class="header-anchor" href="#伪装-sapi-名称" aria-label="Permalink to “伪装 SAPI 名称”">​</a></h2><p>该配置项主要适用于兼容某些对 SAPI 类型有严格检查的扩展或库。通过将 SAPI 名称伪装为 cli，可以避免这些扩展或库因检测到非 cli SAPI 而无法正常工作的问题。</p><p>要启用伪装 SAPI 名称功能，可以在使用 static-php-cli 构建 micro SAPI 时，在 <code>craft.yml</code> 文件中添加以下配置：</p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">build-options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  with-micro-fake-cli</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><p>如果使用 SPC 的 <code>build</code> 命令构建，使用命令行参数 <code>--with-micro-fake-cli</code>：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./spc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bcmath,phar,openssl,mbstring</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --build-micro</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-micro-fake-cli</span></span></code></pre></div><p>伪装后，在 micro.sfx 中执行的 PHP 代码 <code>php_sapi_name()</code> 将返回 <code>cli</code>，而不是 <code>micro</code>。</p><h2 id="ini-注入" tabindex="-1">INI 注入 <a class="header-anchor" href="#ini-注入" aria-label="Permalink to “INI 注入”">​</a></h2><p>micro SAPI 与 cli SAPI 不同，它默认不会读取任何 php.ini 配置文件。因此，如果你的应用程序依赖于特定的 PHP 配置选项，可能需要通过 INI 注入来实现。</p><p>要注入自定义的 INI 配置，可以在使用 static-php-cli 构建 micro SAPI 后准备打包 PHP 代码前，使用 <code>micro:combine</code> 的 <code>-I</code> 配置自动注入 ini 项：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># here to build micro.sfx first</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ./spc craft</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;?php echo ini_get(&quot;memory_limit&quot;) . PHP_EOL;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.php</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./spc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> micro:combine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.php</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;memory_limit=512M&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myapp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./myapp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># output: 512M</span></span></code></pre></div><p>如果有多个 INI 配置项需要注入，可以使用多个 <code>-I</code> 来指定，或使用 <code>-N</code> 指定一个包含多行 ini 配置的文件：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Using multiple -I options</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./spc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> micro:combine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.php</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;memory_limit=512M&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;display_errors=1&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myapp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Using -N with a file</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;memory_limit=512M&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ini.txt</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;display_errors=1&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ini.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./spc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> micro:combine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.php</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -N</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ini.txt</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myapp</span></span></code></pre></div>`,18)])])}const g=s(h,[["render",l]]);export{d as __pageData,g as default};
