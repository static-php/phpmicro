import{_ as s,c as a,o as e,af as n}from"./chunks/framework.BKqm66bb.js";const d=JSON.parse('{"title":"Configuring micro SAPI","description":"","frontmatter":{},"headers":[],"relativePath":"en/customization.md","filePath":"en/customization.md"}'),t={name:"en/customization.md"};function l(h,i,o,p,r,c){return e(),a("div",null,[...i[0]||(i[0]=[n(`<h1 id="configuring-micro-sapi" tabindex="-1">Configuring micro SAPI <a class="header-anchor" href="#configuring-micro-sapi" aria-label="Permalink to “Configuring micro SAPI”">​</a></h1><p>micro SAPI may require custom configuration in certain scenarios to meet specific needs.</p><p>Current micro SAPI configuration mainly includes the following types:</p><ul><li><strong>SAPI Name Masquerading</strong>: Some extensions or libraries may behave differently based on the SAPI name. By configuring SAPI name masquerading, you can make these extensions or libraries believe the current runtime environment is CLI, avoiding compatibility issues.</li><li><strong>INI Injection</strong>: Custom INI configuration can be injected into the micro.sfx binary to override default PHP configuration. This is very useful for applications requiring specific configuration.</li><li><strong>Custom Win32 Metadata</strong>: On Windows platforms, you can customize micro.sfx metadata, such as file description, exe icon, etc.</li></ul><p>This section explains how to use them. For more technical details about these configurations and micro SAPI, see the <a href="./digging-deeper.html">Digging Deeper</a> section.</p><h2 id="sapi-name-masquerading" tabindex="-1">SAPI Name Masquerading <a class="header-anchor" href="#sapi-name-masquerading" aria-label="Permalink to “SAPI Name Masquerading”">​</a></h2><p>This configuration is primarily used for compatibility with certain extensions or libraries that strictly check the SAPI type. By masquerading the SAPI name as CLI, you can avoid issues where these extensions or libraries fail to work properly due to detecting a non-CLI SAPI.</p><p>To enable SAPI name masquerading, when building micro SAPI with static-php-cli, add the following configuration to your <code>craft.yml</code> file:</p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">build-options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  with-micro-fake-cli</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><p>If using SPC&#39;s <code>build</code> command to build, use the command-line parameter <code>--with-micro-fake-cli</code>:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./spc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bcmath,phar,openssl,mbstring</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --build-micro</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-micro-fake-cli</span></span></code></pre></div><p>After masquerading, PHP code executed in micro.sfx calling <code>php_sapi_name()</code> will return <code>cli</code> instead of <code>micro</code>.</p><h2 id="ini-injection" tabindex="-1">INI Injection <a class="header-anchor" href="#ini-injection" aria-label="Permalink to “INI Injection”">​</a></h2><p>Unlike CLI SAPI, micro SAPI doesn&#39;t read any php.ini configuration files by default. Therefore, if your application depends on specific PHP configuration options, you may need to implement this through INI injection.</p><p>To inject custom INI configuration, after building micro SAPI with static-php-cli and before packaging your PHP code, use the <code>-I</code> option of the <code>micro:combine</code> command to automatically inject INI settings:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># here to build micro.sfx first</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ./spc craft</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;?php echo ini_get(&quot;memory_limit&quot;) . PHP_EOL;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.php</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./spc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> micro:combine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.php</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;memory_limit=512M&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myapp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./myapp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># output: 512M</span></span></code></pre></div><p>If you have multiple INI configuration items to inject, you can use multiple <code>-I</code> options, or use <code>-N</code> to specify a file containing multiple lines of INI configuration:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Using multiple -I options</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./spc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> micro:combine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.php</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;memory_limit=512M&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;display_errors=1&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myapp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Using -N with a file</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;memory_limit=512M&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ini.txt</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;display_errors=1&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ini.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./spc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> micro:combine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test.php</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -N</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ini.txt</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myapp</span></span></code></pre></div>`,18)])])}const g=s(t,[["render",l]]);export{d as __pageData,g as default};
