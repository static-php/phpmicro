import{_ as P,c as o,o as a,af as i,ah as t,ai as e}from"./chunks/framework.BKqm66bb.js";const A=JSON.parse('{"title":"micro SAPI for PHP","description":"","frontmatter":{},"headers":[],"relativePath":"zh/index.md","filePath":"zh/index.md"}'),s={name:"zh/index.md"};function p(l,r,n,c,h,m){return a(),o("div",null,[...r[0]||(r[0]=[i('<h1 id="micro-sapi-for-php" tabindex="-1">micro SAPI for PHP <a class="header-anchor" href="#micro-sapi-for-php" aria-label="Permalink to “micro SAPI for PHP”">​</a></h1><p>欢迎来到 static-php 的 micro SAPI 文档！</p><p>此文档由原 <a href="https://github.com/easysoft/phpmicro" target="_blank" rel="noreferrer">easysoft/phpmicro</a> 项目的 <a href="https://docs.toast.run/micro/en/" target="_blank" rel="noreferrer">文档</a> 改编而来， 进行了部分改进，部分文档内容参考自原项目文档。</p><p>本文档以原文档相同的协议 CC BY-SA 4.0 进行发布，详情请参见 <a href="./../LICENSE-CC.html">许可证</a>。</p><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to “概述”">​</a></h2><p>本 phpmicro 文档适用于 static-php/phpmicro 项目，该项目 fork 自 <a href="https://github.com/easysoft/phpmicro" target="_blank" rel="noreferrer">easysoft/phpmicro</a>，并进行了部分改进， 部分文档内容参考自原项目文档。</p><p>micro SAPI 是 PHP 的一个 SAPI 模块，允许你创建自执行的 PHP 二进制文件。 通过将 micro SAPI 二进制文件与你的 PHP 源代码或 PHAR 文件连接， 你可以在不需要单独安装 PHP 的情况下运行 PHP 应用程序。</p><p>不需要重量级的 Docker 镜像，不需要预先安装 PHP 环境，只需一个小巧的二进制文件即可运行你的 PHP 应用程序。</p><h2 id="它是怎么工作的" tabindex="-1">它是怎么工作的 <a class="header-anchor" href="#它是怎么工作的" aria-label="Permalink to “它是怎么工作的”">​</a></h2><p>PHP 有多种不同的 SAPI（Server API）接口，允许 PHP 以不同的方式运行。最常见的 SAPI 是 fpm（FastCGI 进程管理器）和 cli（命令行接口）。</p><p>以 cli 举例，cli SAPI 允许我们从命令行运行 PHP 脚本。我们可以直接在终端中执行 PHP 代码，适用于编写命令行工具和脚本。而执行方式也是最简单的。</p><p><img src="'+t+'" alt=""></p><p>对于 micro SAPI，它和 cli SAPI 类似，但它允许我们将 PHP 代码拼接到一个自执行的二进制文件中。这个二进制文件包含了 PHP 解释器和你的应用代码。</p><p><img src="'+e+'" alt=""></p><p>你可能认为它和 WinRAR 等压缩软件提供的自解压文件类似，但实际上它们的实现方式不同。 WinRAR 的自解压文件是一个压缩包，运行时会解压缩内容到临时目录再执行，而 micro SAPI 是将 PHP 解释器和代码直接拼接在一起， 运行时不需要解压缩，直接执行即可。</p><h2 id="使用场景" tabindex="-1">使用场景 <a class="header-anchor" href="#使用场景" aria-label="Permalink to “使用场景”">​</a></h2><p>首先，相较于传统的 PHP 运行方式（cli、fpm、apache-mod-php 等），micro SAPI 解决了一个重要问题：<strong>不需要预先安装 PHP 环境</strong>。 它可以极大地方便 PHP 开发者编写通用的终端命令行工具，用户只需下载一个二进制文件即可运行，无需担心 PHP 版本和扩展依赖。</p><p>如果我们和其他语言的构建便携工具的特点相比较，你会发现 micro SAPI 解决了很多其他语言构建便携工具时遇到的问题。</p><ul><li><strong>Go</strong>：Go 语言可以编译为静态链接的二进制文件，但每次修改代码都需要重新编译。</li><li><strong>Python</strong>：Python 需要预先安装 Python 解释器。即使使用了 PyInstaller 等工具打包，它也会在执行时解压缩到临时目录，增加了读写开销。</li><li><strong>Bash 脚本</strong>：对于 Windows 用户来说需要预先安装 Bash 解释器，且语法不够灵活。</li><li><strong>Java</strong>：Java 打包成 jar 需要预先安装 Java 运行时环境（JRE），且启动时需要加载大量类库，启动速度较慢。</li></ul><p>而 micro SAPI 结合了静态编译和解释执行的优点，既不需要预先安装 PHP 环境，也不需要每次修改代码都重新编译，同时启动速度也很快，非常适合构建便携的命令行工具。</p><ul><li><strong>PHP 语法灵活</strong>：PHP 语法简单易学，适合快速编写脚本和工具。</li><li><strong>丰富的扩展支持</strong>：PHP 的扩展大多由 C 语言开发，可以方便地嵌入式构建到 PHP 二进制文件中。</li><li><strong>跨平台友好</strong>：相比 Bash 脚本，使用 micro SAPI 编写脚本可以更好地支持 Windows 平台。</li><li><strong>快速启动</strong>：PHP 解释器启动速度快，不涉及 PHP 代码的提取到临时目录的步骤。</li><li><strong>依赖管理简单</strong>：PHP 的主流 C 扩展都可以静态编译，Composer 依赖可以打包到 PHAR 文件中，极大简化了依赖管理。</li></ul><p>当然，micro SAPI 也有一些局限性：</p><ul><li><strong>不适合 Web 应用</strong>：micro SAPI 主要面向命令行工具和脚本，不适合构建传统的 fpm 应用。当然，你可以配合 swoole 等 cli 兼容的扩展来实现 Web 服务。</li><li><strong>不提供源码保护</strong>：micro 不提供源码加密或混淆功能，PHP 代码仍然是明文的。</li><li><strong>更换扩展需要重新构建</strong>：如果需要添加或移除 PHP 扩展，需要重新构建 micro SAPI 二进制文件。</li></ul><p>由于它本质上不属于传统的 SAPI，因此在某些特殊场景下可能会遇到兼容性问题，具体请参考下面的兼容性章节。</p><h2 id="兼容性" tabindex="-1">兼容性 <a class="header-anchor" href="#兼容性" aria-label="Permalink to “兼容性”">​</a></h2><p>对于 PHP 自身的兼容性，micro SAPI 支持从 PHP 8.0 到最新的 PHP 8.5 版本。</p><p>对于 PHP 代码的兼容性，micro SAPI 支持绝大多数基于 CLI 的 PHP 应用程序和脚本。 只要你的代码不依赖于特定的 SAPI 功能，通常都可以正常运行。</p><p>对于 PHP 扩展的兼容性，micro SAPI 支持大部分常用的 PHP 扩展，如 pdo、openssl、mbstring 等。 但是，一些存在 SAPI 类型判断的扩展可能无法正常工作，在某些情况下会检查 SAPI 类型，如果检测到不是 cli 可能会无法使用。</p>',28)])])}const d=P(s,[["render",p]]);export{A as __pageData,d as default};
